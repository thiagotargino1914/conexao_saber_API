<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Conexão Saber - Aluno (Offline)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563EB"/>
  <style>
    body { background:#f8fafc; }
    .card { border-radius:12px; }
    .app-title { font-weight:700; letter-spacing:0.2px; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="h4 mb-3 app-title">Conexão Saber - Aluno (Offline)</h1>

    <div id="auth" class="card p-3 mb-3">
      <h2 class="h6">Login / Cadastro</h2>
      <div class="mb-2">
        <input id="email" class="form-control mb-2" placeholder="E-mail">
        <input id="password" type="password" class="form-control mb-2" placeholder="Senha">
        <div class="d-flex gap-2">
          <button id="btnLogin" class="btn btn-primary flex-grow-1">Entrar</button>
          <button id="btnRegister" class="btn btn-outline-secondary flex-grow-1">Cadastrar</button>
        </div>
      </div>
    </div>

    <div id="app" style="display:none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <strong id="userEmail"></strong>
        <button id="btnLogout" class="btn btn-sm btn-danger">Sair</button>
      </div>

      <div id="coursesList"></div>
    </div>

    <hr>
    <small class="text-muted">Versão simplificada — abra este arquivo no navegador do celular e escolha “Adicionar à tela inicial” para instalar como app.</small>
  </div>

<script>
if(!localStorage.getItem('integraedu_data')){
  const data = {
    users: [],
    courses: [
      {
        id:1,
        title:'Matemática ENEM',
        description:'Foco em álgebra, funções e geometria analítica.',
        teacher:'Prof. Álvaro',
        lessons:[{title:'Funções - Conceitos',url:'https://www.youtube.com/watch?v=dQw4w9WgXcQ'}]
      },
      {
        id:2,
        title:'Redação ENEM',
        description:'Técnicas de escrita para a prova do ENEM.',
        teacher:'Profa. Ana',
        lessons:[{title:'Estrutura da Redação ENEM',url:'https://www.youtube.com/watch?v=3GwjfUFyY6M'}]
      }
    ]
  };
  localStorage.setItem('integraedu_data', JSON.stringify(data));
}

let data = JSON.parse(localStorage.getItem('integraedu_data'));

const auth = document.getElementById('auth');
const app = document.getElementById('app');
const emailIn = document.getElementById('email');
const passIn = document.getElementById('password');
const btnLogin = document.getElementById('btnLogin');
const btnRegister = document.getElementById('btnRegister');
const btnLogout = document.getElementById('btnLogout');
const userEmail = document.getElementById('userEmail');
const coursesList = document.getElementById('coursesList');

function renderCourses(){
  coursesList.innerHTML = '';
  data.courses.forEach(c=>{
    const card = document.createElement('div');
    card.className='card mb-2 p-3';
    card.innerHTML = `
      <h5 class="mb-1">${c.title}</h5>
      <div class="mb-2 text-muted small">${c.teacher}</div>
      <p class="mb-2">${c.description}</p>
      <button class="btn btn-sm btn-primary" onclick="openCourse(${c.id})">Abrir Curso</button>
    `;
    coursesList.appendChild(card);
  });
}

function openCourse(id){
  const c = data.courses.find(x=>x.id===id);
  if(!c) return alert('Curso não encontrado');
  const lessons = c.lessons.map((l,i)=>`<li class="mb-2"><strong>${i+1} — ${l.title}</strong><br><a href="${l.url}" target="_blank">Abrir aula (link)</a></li>`).join('');
  const html = `<div class="p-3"><h5>${c.title}</h5><ul class="list-unstyled mt-3">${lessons}</ul></div>`;
  const w = window.open('about:blank','_blank','noopener');
  w.document.write(html);
  w.document.close();
}

btnLogin.addEventListener('click', ()=>{
  const u = data.users.find(x=>x.email===emailIn.value && x.password===passIn.value);
  if(u){
    sessionStorage.setItem('integra_user', JSON.stringify(u));
    startApp();
  } else alert('Usuário não encontrado. Registre-se primeiro.');
});

btnRegister.addEventListener('click', ()=>{
  if(!emailIn.value || !passIn.value) return alert('Preencha e-mail e senha');
  const exists = data.users.find(x=>x.email===emailIn.value);
  if(exists) return alert('Usuário já existe. Faça login.');
  const u = {email: emailIn.value, password: passIn.value};
  data.users.push(u);
  localStorage.setItem('integraedu_data', JSON.stringify(data));
  alert('Cadastrado com sucesso — agora faça login');
});

btnLogout.addEventListener('click', ()=>{ sessionStorage.removeItem('integra_user'); location.reload(); });

function startApp(){
  const u = JSON.parse(sessionStorage.getItem('integra_user'));
  if(!u) return;
  auth.style.display='none';
  app.style.display='block';
  userEmail.textContent = u.email;
  renderCourses();
}

if(sessionStorage.getItem('integra_user')) startApp();

if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').catch(()=>{ /* silent */});
}
</script>
</body>
</html>
